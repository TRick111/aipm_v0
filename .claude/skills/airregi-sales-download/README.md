# AirRegi日別売上CSVダウンロード Skill

AirRegiから指定された店舗・月の日別売上データ（会計明細）を自動的にダウンロードするClaude Skillです。

## 概要

このSkillは、Playwright MCPを使用してブラウザ操作を自動化し、以下の処理を実行します：

1. AirRegiにログイン
2. 「BAR FIVE Arrows」店舗を選択
3. 「売上・分析」→「日別売上」メニューに移動
4. 指定した年月を選択
5. 会計明細CSVをダウンロード

---

## 前提条件

### 必須

- ✅ **Playwright MCP** がインストール・設定済みであること
- ✅ **AirRegiアカウント** （BAR FIVE Arrows店舗へのアクセス権限）
- ✅ **ログイン情報** （メールアドレス/パスワード）

### 確認事項

- Playwright MCPが正しく動作しているか確認してください
- ブラウザ（Chrome, Firefox等）がインストールされているか確認してください
- ダウンロード先ディレクトリ `C:\Users\auk1i\Downloads` が存在するか確認してください

---

## 使い方

### 基本的な実行方法

Claude Codeで以下のように依頼してください：

```
AirRegi日別売上CSVダウンロードのSkillを実行してください。

メールアドレス: example@email.com
パスワード: ********
対象年: 2026
対象月: 1
```

### パラメータの説明

| パラメータ | 必須 | 説明 | 例 |
|-----------|-----|------|-----|
| `メールアドレス` または `AirID` | ✅ | AirRegiのログイン情報 | `example@email.com` |
| `パスワード` | ✅ | AirRegiのパスワード | `********` |
| `対象年` | ✅ | ダウンロードする年 | `2026` |
| `対象月` | ✅ | ダウンロードする月（1-12） | `1` |

---

## 実行フロー

Skillは以下の順序で処理を実行します：

```
[1] ログインページへ遷移
  ↓
[2] ページ状態を確認（スナップショット）
  ↓
[3] メールアドレス/パスワードを入力
  ↓
[4] ログインボタンをクリック
  ↓
[5] ページ読み込みを待機
  ↓
[6] 店舗選択（BAR FIVE Arrows）
  ↓
[7] 「売上・分析」メニューを展開（必要に応じて）
  ↓
[8] 「日別売上」をクリック
  ↓
[9] 年月を選択して「表示する」
  ↓
[10] ページ読み込みを待機
  ↓
[11] 「CSVデータをダウンロードする」を探す
  ↓
[12] 「会計明細」をクリック
  ↓
[13] ダウンロード完了を待機
  ↓
[完了] ブラウザを閉じる
```

---

## 出力

### 成功時

ダウンロードされたCSVファイルが以下の場所に保存されます：

```
C:\Users\auk1i\Downloads\会計明細_YYYYMMDD.csv
```

**ファイル形式**:
- UTF-8 または Shift-JIS エンコーディング
- カンマ区切りのCSV形式
- 指定月の全ての会計明細データ（来店日時、商品、金額、人数など）

### 失敗時

エラーメッセージと、どのステップで失敗したかが報告されます。詳細は [skill.md](skill.md) の「エラーハンドリング」セクションを参照してください。

---

## Dashboard との連携

ダウンロードしたCSVファイルは、RestaurantAILab Dashboard にアップロードして分析できます：

### 手順

1. **Dashboardにアクセス**
   ```
   http://localhost:3000/store/store-001/upload
   ```

2. **CSVファイルをアップロード**
   - ダウンロードした `会計明細_YYYYMMDD.csv` を選択
   - アップロードボタンをクリック

3. **ダッシュボードで確認**
   - 自動的に解析され、月別ダッシュボードが表示されます
   - 売上推移、週次分析、メニュー分析、商品分析などが可視化されます

詳細は以下のドキュメントを参照：
- [バルクアップロード](../../docs/運用ガイド/バルクアップロード.md)
- [スクリプト一覧](../../docs/運用ガイド/スクリプト一覧.md)

---

## エラーハンドリング

### よくあるエラーと対処法

#### 1. ログイン失敗

**エラー**: 「メールアドレスまたはパスワードが正しくありません」

**対処**:
- メールアドレス/AirIDが正しいか確認
- パスワードが正しいか確認
- アカウントがロックされていないか確認
- AirRegiの公式サイトで直接ログインを試してみる

#### 2. 店舗が見つからない

**エラー**: 「BAR FIVE Arrows が見つかりません」

**対処**:
- ログインしているアカウントに店舗へのアクセス権限があるか確認
- 店舗名が変更されていないか確認
- 複数店舗がある場合、正しい店舗が表示されているか確認

#### 3. CSVボタンが見つからない

**エラー**: 「CSVデータをダウンロードするボタンが見つかりません」

**対処**:
- ページを下にスクロールして再度探す
- 指定した年月にデータが存在するか確認
- AirRegiのUIが更新された可能性があるため、手動で確認

#### 4. ダウンロードが開始されない

**エラー**: 「ファイルがダウンロードされませんでした」

**対処**:
- ブラウザのポップアップブロックを確認
- ダウンロード先ディレクトリが存在するか確認
- 少し待機してから再度実行

---

## トラブルシューティング

### Playwright MCPが動作しない

```bash
# Playwrightが正しくインストールされているか確認
npx playwright --version

# ブラウザドライバをインストール
npx playwright install
```

### ブラウザが起動しない

- システムにChrome, Firefox, Edgeなどのブラウザがインストールされているか確認
- Playwright MCPの設定を確認

### ダウンロード先が見つからない

```bash
# ディレクトリの存在確認（PowerShell）
Test-Path "C:\Users\auk1i\Downloads"

# ディレクトリの存在確認（Command Prompt）
dir "C:\Users\auk1i\Downloads"
```

---

## セキュリティ

### パスワードの取り扱い

- **推奨**: 環境変数や設定ファイルから読み込む
- **非推奨**: スクリプトやログに平文でパスワードを記載しない

**環境変数の例**:

```bash
# .env ファイル
AIRREGI_EMAIL=example@email.com
AIRREGI_PASSWORD=********
```

Claudeに実行を依頼する際：

```
AirRegi日別売上CSVダウンロードのSkillを実行してください。
環境変数 AIRREGI_EMAIL と AIRREGI_PASSWORD を使用してください。
対象年: 2026
対象月: 1
```

---

## ファイル構成

```
skills/airregi-sales-download/
├── skill.md          # Skill定義ファイル（詳細な実装手順）
└── README.md         # このファイル（使い方ガイド）
```

---

## 技術仕様

### 使用ツール

| ツール名 | 用途 |
|---------|------|
| `mcp__playwright__browser_navigate` | ページ遷移 |
| `mcp__playwright__browser_snapshot` | ページ状態確認 |
| `mcp__playwright__browser_fill_form` | フォーム入力 |
| `mcp__playwright__browser_click` | 要素クリック |
| `mcp__playwright__browser_select_option` | セレクトボックス選択 |
| `mcp__playwright__browser_wait_for` | 待機 |
| `mcp__playwright__browser_close` | ブラウザ終了 |

### 固定値

- **ログインURL**: `https://connect.airregi.jp/login?client_id=ARG&redirect_uri=...`
- **店舗名**: `BAR FIVE Arrows`
- **ダウンロード先**: `C:\Users\auk1i\Downloads`

---

## 更新履歴

| 日付 | バージョン | 更新内容 |
|------|-----------|----------|
| 2026-01-03 | 1.0.0 | 初版作成 |

---

## サポート

質問や問題が発生した場合：

1. [skill.md](skill.md) の詳細な実装手順を確認
2. エラーハンドリングセクションを確認
3. トラブルシューティングセクションを確認
4. AirRegi公式サポートに問い合わせ

---

## ライセンス

このSkillは Restaurant AI Lab プロジェクトの一部です。

---

## 関連ドキュメント

- **Skill詳細**: [skill.md](skill.md)
- **開発ルール**: [../../docs/設計書/開発ルール.md](../../docs/設計書/開発ルール.md)
- **バルクアップロード**: [../../docs/運用ガイド/バルクアップロード.md](../../docs/運用ガイド/バルクアップロード.md)
- **スクリプト一覧**: [../../docs/運用ガイド/スクリプト一覧.md](../../docs/運用ガイド/スクリプト一覧.md)
