# 週報自動化 - 全体フロー整理

**作成日**: 2026-01-25
**目的**: 週報作成プロセスの自動化に向けた全体像の整理

---

## 1. 現状の週報作成フロー

### 1.1 入力データ
| データ | ファイル | 説明 |
|--------|----------|------|
| POSデータ | `rawdata.csv` | 売上トランザクションデータ |
| 口コミデータ | `reviews.csv` | Google/食べログ等の口コミ |

**対象店舗**:
- BFA (Five Arrows)
- BBC
- （他店舗も追加可能）

### 1.2 現在のフロー（手動）

```
┌─────────────────────────────────────────────────────────────┐
│ Step 1: データ準備                                          │
│   - rawdata.csv と reviews.csv を 1_input/ に配置           │
│   - 対象週を確認                                            │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 2: Python分析スクリプト実行                            │
│   python analysis_script.py                                 │
│                                                             │
│   【出力】                                                  │
│   - analysis_results.json（全分析結果）                     │
│   - weekly_sales.csv（週次集計）                            │
│   - category_composition_trend.csv（カテゴリ構成比推移）    │
│   - product_composition_trend.csv（商品構成比推移）         │
│   - weekday_decomposition.csv（曜日別要因分解）             │
│   - hourly_sales.csv（時間帯別）                           │
│   - その他CSVファイル                                       │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 3: Claude AI による自然言語分析（★手動対話）           │
│                                                             │
│   - analysis_results.json を読み込ませる                    │
│   - 分析観点.md の基準に従って分析依頼                      │
│   - 週報作成基礎資料.md を生成                             │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 4: Word形式への変換                                    │
│   python generate_docx.py                                   │
│                                                             │
│   【出力】                                                  │
│   - 週報作成基礎資料.docx                                   │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ Step 5: Googleスライド作成（手動）                          │
│   - Word/Markdownを元にスライド作成                         │
│   - テンプレートに沿って整形                                │
└─────────────────────────────────────────────────────────────┘
```

### 1.3 現状の課題・ボトルネック

| # | 課題 | 影響 |
|---|------|------|
| 1 | Step 3（AI分析）が手動対話 | 毎回プロンプト作成、時間がかかる |
| 2 | 複数店舗対応が手動 | 店舗ごとにスクリプト/フォルダ管理 |
| 3 | 週番号指定が手動 | スクリプト内の日付を毎回編集 |
| 4 | スライド作成が完全手動 | 最も時間がかかる工程 |
| 5 | プロンプト/テンプレートが分散 | 再利用・更新が煩雑 |

---

## 2. 自動化の目標

### 2.1 理想の姿（End-to-End自動化）

```
【入力】
  - 店舗名（BFA, BBC等）
  - 対象週（例: 2026-W03）
  - rawdata.csv, reviews.csv のパス

        ↓ 1コマンド実行

【出力】
  - 週報作成基礎資料.md
  - 週報作成基礎資料.docx
  - 週報スライド.md（スライド構成案）
  - （可能であれば）Googleスライド直接生成
```

### 2.2 自動化の優先度

| 優先度 | 対象 | 効果 |
|--------|------|------|
| 高 | Step 3: AI分析の自動化 | 最大のボトルネック解消 |
| 高 | 店舗・週指定のパラメータ化 | 柔軟性向上 |
| 中 | Step 1-2-4の統合スクリプト | 一気通貫実行 |
| 中 | プロンプト/テンプレートの一元管理 | 保守性向上 |
| 低 | Googleスライド自動生成 | 最終成果物の自動化 |

---

## 3. 自動化の技術的アプローチ（案）

### 3.1 AI分析の自動化

**選択肢**:
1. **Cursor/Claude統合**: 現在のワークフローをそのまま活用
2. **Claude API直接呼び出し**: Pythonスクリプトから直接API呼び出し
3. **LangChain等のフレームワーク**: より複雑なワークフロー構築

**推奨**: まずは Cursor/Claude 統合で進め、プロンプト標準化を行う

### 3.2 統合スクリプト構成案

```
週報自動化/
├── main.py                    # エントリーポイント
├── config.yaml                # 店舗設定、パス設定
├── prompts/                   # プロンプトテンプレート
│   ├── analysis_prompt.md     # AI分析用プロンプト
│   └── slide_prompt.md        # スライド構成用プロンプト
├── scripts/
│   ├── analyze.py             # Python分析（既存流用）
│   ├── generate_report.py     # レポート生成
│   └── generate_docx.py       # Word変換（既存流用）
└── output/                    # 出力先
```

### 3.3 処理フロー（自動化版）

```python
# main.py のイメージ
def run_weekly_report(store: str, week: str):
    # 1. 設定読み込み
    config = load_config(store)
    
    # 2. Python分析実行
    analysis_results = run_analysis(config, week)
    
    # 3. AI分析（プロンプト自動構築 → API呼び出し）
    report_md = generate_ai_report(analysis_results, prompts)
    
    # 4. Word変換
    generate_docx(report_md)
    
    # 5. スライド構成案生成
    generate_slide_outline(report_md)
```

---

## 4. 次のステップ（TODO）

### Phase 1: 現状整理・設計
- [ ] 既存スクリプトの棚卸し
- [ ] 入出力フォーマットの確認
- [ ] プロンプトテンプレートの整理
- [ ] 店舗別設定の洗い出し

### Phase 2: プロトタイプ実装
- [ ] 統合スクリプトの骨格作成
- [ ] 設定ファイル（config.yaml）作成
- [ ] プロンプトテンプレートの標準化

### Phase 3: テスト・改善
- [ ] BFA店舗でテスト実行
- [ ] 出力品質の確認・調整
- [ ] 他店舗への横展開

---

## 5. 参照ドキュメント

| ドキュメント | パス | 内容 |
|--------------|------|------|
| 週報README | `Stock/RestaurantAILab/週報/README.md` | システム全体の運用ガイド |
| 分析観点 | `Stock/RestaurantAILab/週報/分析観点.md` | AI分析時の判断基準 |
| 週報作成プロンプト | `Stock/RestaurantAILab/週報/週報作成プロンプトテンプレート.md` | AI分析用プロンプト |
| スライドテンプレート | `Stock/RestaurantAILab/週報/3.template/週報スライド構成テンプレート.md` | スライド構成 |

---

## 6. 議論ポイント・決定事項

（以下、検討しながら追記）

### Q1: AI分析の自動化方式
- [ ] Cursor内での対話継続
- [ ] Claude API直接呼び出し
- [ ] その他

### Q2: 複数店舗対応の優先度
- [ ] まずBFA単独で完成させる
- [ ] 最初から複数店舗対応設計

### Q3: 最終出力形式
- [ ] Markdown + Word で十分
- [ ] Googleスライド連携も必須

---

**次のアクション**: 既存スクリプトの棚卸し、プロンプトテンプレートの確認
