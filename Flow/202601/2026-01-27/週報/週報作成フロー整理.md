# 週報作成フロー整理

**作成日**: 2026年1月27日  
**目的**: 週報プロジェクトのファイル構造を整理し、週報作成の流れを明確化する

---

## 1. 週報作成の全体フロー

```
┌──────────────────────────────────────────────────────────────────┐
│ 【フェーズ1】基礎資料作成                                        │
│ プロンプト: 週報作成プロンプトテンプレート.md                     │
│ スクリプト: analysis_script.py                                   │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ 【フェーズ2】曜日深掘り分析                                      │
│ プロンプト: 曜日深堀分析_プロンプト.md                           │
│ スクリプト: deep_dive_weekday_analysis.py                        │
└──────────────────────────────────────────────────────────────────┘
                              ↓
┌──────────────────────────────────────────────────────────────────┐
│ 【フェーズ3】スライド構成案作成                                  │
│ テンプレート: 3.template/Five Arrows 週報スライド構成テンプレート.md │
│ スクリプト: なし（AI対話で作成）                                 │
└──────────────────────────────────────────────────────────────────┘
```

---

## 2. フェーズ1: 基礎資料作成

### 2.1 使用ファイル

| 種類 | ファイルパス |
|------|-------------|
| プロンプト | `Stock/RestaurantAILab/週報/01_週報作成プロンプトテンプレート.md` |
| スクリプト | `Stock/RestaurantAILab/週報/Scripts/analysis_script.py` |
| 参照資料 | `Stock/RestaurantAILab/週報/分析観点.md` |

### 2.2 入力データ

```
Stock/RestaurantAILab/週報/1_input/{運営会社}/
├── rawdata.csv    # 売上トランザクションデータ
└── reviews.csv    # 口コミデータ
```

**運営会社コード**:
- `BFA`: Bar Five Arrows
- `BBC`: Bar Bunkamura Cocoon

### 2.3 実行コマンド

```bash
# 基本実行（スライド用データのみ出力、グラフなし）
python "Stock/RestaurantAILab/週報/Scripts/analysis_script.py" \
  -w 2026-W01 \
  -e 2026-01-03 \
  --sales-data "Stock/RestaurantAILab/週報/1_input/BBC/rawdata.csv" \
  --reviews-data "Stock/RestaurantAILab/週報/1_input/BBC/reviews.csv" \
  -o "Stock/RestaurantAILab/週報/2_output/BBC/2_output_2026w01"

# グラフ画像も出力する場合
python "Stock/RestaurantAILab/週報/Scripts/analysis_script.py" \
  -w 2026-W01 \
  -e 2026-01-03 \
  --sales-data "Stock/RestaurantAILab/週報/1_input/BBC/rawdata.csv" \
  --reviews-data "Stock/RestaurantAILab/週報/1_input/BBC/reviews.csv" \
  -o "Stock/RestaurantAILab/週報/2_output/BBC/2_output_2026w01" \
  --images
```

### 2.4 出力ファイル

```
Stock/RestaurantAILab/週報/2_output/{運営会社}/2_output_{week}/
│
├── 【スライド用データ（テキスト形式）】※ 常に出力
│   ├── slide_data_part1.txt         # 第1部用（週次トレンド、KPI、前年比較）
│   ├── slide_data_part2.txt         # 第2部用（曜日別概況、深掘りデータ、時間帯別）
│   └── slide_data_part3.txt         # 第3部用（カテゴリ構成比、商品TOP10、構成比増減）
│
├── 【データファイル（CSV/JSON）】※ 常に出力
│   ├── analysis_results.json        # 分析結果（全データ構造化）
│   ├── weekly_sales.csv             # 週次売上データ
│   ├── weekday_decomposition.csv    # 曜日別要因分解データ
│   ├── hourly_sales.csv             # 時間別売上データ
│   ├── category_latest.csv          # 対象週カテゴリ別売上
│   ├── product_latest.csv           # 対象週商品別売上
│   ├── category_composition_trend.csv  # カテゴリ別構成比推移
│   ├── product_composition_trend.csv   # 商品別構成比推移（TOP20）
│   └── analysis_memo.txt            # 分析中間メモ
│
├── 【グラフ画像（PNG）】※ --images 指定時のみ出力
│   ├── weekly_sales_comparison.png  # 週次売上比較（棒グラフ）
│   ├── weekly_sales_trend.png       # 週次売上推移（折れ線グラフ）
│   ├── weekday_decomposition.png    # 曜日別要因分解グラフ
│   ├── hourly_sales.png             # 時間別売上グラフ
│   ├── category_sales.png           # カテゴリ別売上構成比（円グラフ）
│   ├── top_products.png             # 商品別売上構成比TOP10（円グラフ）
│   └── reviews_trend.png            # 口コミ評価推移グラフ
│
└── 【週報基礎資料】
    └── 週報作成基礎資料.md           # Markdown形式の週報基礎資料
```

---

## 3. フェーズ2: 曜日深掘り分析

### 3.1 使用ファイル

| 種類 | ファイルパス |
|------|-------------|
| プロンプト | `Stock/RestaurantAILab/週報/02_曜日深堀分析_プロンプト.md` |
| スクリプト | `Stock/RestaurantAILab/週報/Scripts/deep_dive_weekday_analysis.py` |

### 3.2 入力データ

- `rawdata.csv`（フェーズ1と同じ）
- `weekday_decomposition.csv`（フェーズ1で生成）

### 3.3 実行コマンド

```bash
# 自動判定モード（weekday_decomposition.csvから好調/不調曜日を自動特定）
python "Stock/RestaurantAILab/週報/Scripts/deep_dive_weekday_analysis.py" \
  -w 2026-W01 -e 2026-01-03 --auto

# 手動指定モード
python "Stock/RestaurantAILab/週報/Scripts/deep_dive_weekday_analysis.py" \
  -w 2026-W01 -e 2026-01-03 \
  --best-date 2025-12-31 --worst-date 2026-01-02
```

### 3.4 分析の5つの観点

1. **パーティサイズ分析**: 1名/2名/3-4名/5名以上の構成変化
2. **時間帯バケット分析**: ピーク時間（18-19、20-21等）の人数・売上推移
3. **会計レベル分析**: 大口会計の有無、単価分布（中央値、P10、P90）
4. **商品ミックス分析**: 高単価商品の販売数、カテゴリ別売上構成
5. **例外データ確認**: 営業時間外会計、特殊計上の混入

### 3.5 出力

- 週報基礎資料の「1.2 曜日別分析」セクションに深掘り分析を追加
- コンソール出力として詳細分析結果（テキスト形式）

---

## 4. フェーズ3: スライド構成案作成

### 4.1 使用ファイル

| 種類 | ファイルパス |
|------|-------------|
| プロンプト | `Stock/RestaurantAILab/週報/03_スライド構成案作成_プロンプト.md` |
| テンプレート | `Stock/RestaurantAILab/週報/3.template/Five Arrows 週報スライド構成テンプレート.md` |
| 入力 | 週報作成基礎資料.md（フェーズ1-2で作成） |

### 4.2 実行方法

`03_スライド構成案作成_プロンプト.md` に記載のプロンプトをAIに依頼。

**主な要件**:
- テンプレートに沿った28枚構成
- グラフ描画に必要なX軸・Y軸の値を表として完全に含める

### 4.3 スライド構成（28枚）

| 部 | 枚数 | 内容 |
|----|------|------|
| 第1部：全体サマリー | 6枚 | タイトル、エグゼクティブサマリー、売上/客数/客単価トレンド、前年同週比 |
| 第2部：曜日別詳細分析 | 12枚 | 曜日別概況、不調曜日深掘り（5枚）、好調曜日深掘り（5枚）、まとめ |
| 第3部：商品・カテゴリ分析 | 5枚 | カテゴリ構成比、好調カテゴリ、商品TOP10、構成比変化、まとめ |
| 第4部：今週の総括 | 2枚 | 強み（Win）、課題（Loss） |
| 第5部：施策一覧 | 3枚 | メニュー/集客、顧客/運営、スタッフ育成 |

### 4.4 出力要件

- テンプレートに沿った28枚構成
- **各グラフに必要なX軸・Y軸データを表形式で明記**
  - 例：時間帯別売上グラフの場合、時間帯（18-19、20-21...）とその売上金額を表で提示

---

## 5. 不要ファイル一覧（OLD移動済み）

### 5.1 特定週固定のスクリプト（汎用版に統合済み）

| ファイル名 | 説明 | 統合先 |
|-----------|------|--------|
| `analyze_weekday_deep_dive.py` | 2025-W52固定の曜日分析 | `deep_dive_weekday_analysis.py` |
| `weekday_deepdive_analysis.py` | 2025-W52固定の曜日分析 | `deep_dive_weekday_analysis.py` |
| `deep_dive_analysis.py` | W42固定の深掘り分析 | `deep_dive_weekday_analysis.py` |
| `create_word_report.py` | W42固定のWordレポート作成 | `generate_docx.py` |

### 5.2 特定日固定の一時スクリプト

| ファイル名 | 説明 |
|-----------|------|
| `analyze_pos.py` | 12月データ固定の一時分析 |
| `calculate_groups.py` | W51/W52固定の組数計算 |
| `deep_dive_friday.py` | 2026-01-02固定の金曜分析 |
| `deep_dive_wednesday.py` | 2025-12-31固定の水曜分析 |

### 5.3 使用されていないスクリプト

| ファイル名 | 説明 |
|-----------|------|
| `deep_dive.py` | 空ファイル |
| `generate_pdf.py` | PDF出力（現在未使用） |
| `generate_docx.py` | Word変換（現在未使用） |
| `fix_markdown_bullets.py` | Markdown修正（現在未使用） |

### 5.4 一時ファイル

| ファイル名 | 説明 |
|-----------|------|
| `test.txt` | テストファイル |
| `analysis_result.txt` | 一時出力ファイル |

---

## 6. 整理後のフォルダ構造

```
Stock/RestaurantAILab/週報/
│
├── 【プロンプト】（実行順に番号付き）
│   ├── 00_週報作成_統合プロンプト.md        # 全フェーズ一気通貫実行
│   ├── 01_週報作成プロンプトテンプレート.md  # フェーズ1: 基礎資料作成
│   ├── 02_曜日深堀分析_プロンプト.md        # フェーズ2: 曜日深掘り
│   └── 03_スライド構成案作成_プロンプト.md  # フェーズ3: スライド構成
│
├── 【テンプレート・参照資料】
│   ├── 分析観点.md                         # AI分析時の判断基準
│   └── 3.template/
│       └── Five Arrows 週報スライド構成テンプレート.md
│
├── 【Scripts】
│   ├── analysis_script.py                  # フェーズ1: 基礎分析
│   └── deep_dive_weekday_analysis.py       # フェーズ2: 曜日深掘り
│
├── 【データ】
│   ├── 1_input/{運営会社}/                 # 入力データ
│   └── 2_output/{運営会社}/{week}/         # 出力データ
│
├── 【ドキュメント】
│   ├── README.md                           # システム全体説明
│   └── README_曜日深堀分析.md              # 曜日深掘り分析説明
│
└── 【old】                                  # 不要ファイル格納（16ファイル）
    ├── analyze_pos.py
    ├── analyze_weekday_deep_dive.py
    ├── analyze_week52.py
    ├── analysis_script_week42.py
    ├── analysis_result.txt
    ├── calculate_groups.py
    ├── create_word_report.py
    ├── deep_dive_analysis.py
    ├── deep_dive_friday.py
    ├── deep_dive_wednesday.py
    ├── deep_dive.py
    ├── fix_markdown_bullets.py
    ├── generate_docx.py
    ├── generate_pdf.py
    ├── test.txt
    └── weekday_deepdive_analysis.py
```

---

## 7. 完了したアクション

- [x] 不要ファイルをoldフォルダに移動（16ファイル）
- [x] プロンプトファイルに実行順番の番号を付与
- [x] スライド構成案作成プロンプトを新規作成
- [x] 統合プロンプト（00番）を作成
- [x] Pythonスクリプトに`--images`オプションを追加（デフォルトOFF）
- [x] スライド用データ出力機能を追加（slide_data_part1/2/3.txt）
- [x] 商品別4週平均比較データを追加

## 8. 今後のアクション（必要に応じて）

- [ ] 移動後の動作確認（メインスクリプトの実行テスト）
- [ ] README.mdの更新
- [ ] deep_dive_weekday_analysis.pyの4週平均比較機能拡張
