---
date: 2026-01-28
project: GFS飲食店分析
store: 直送生ホルモンなかせい
type: notes
version: 1.0
---

# 取引データ（POS）スキーマ調査メモ

## 対象ファイル（input）
- `取引データ(取引日時=20241201-20251130).csv`
- `取引データ(取引日時=20251201-20260128).csv`

## マージ結果
- **作成ファイル**: `work/merged_transactions_20241201_20260128.csv`
- **エンコーディング**: 入力は両方とも **cp932**、出力は **UTF-8**
- **列数**: 63列（+ `source_file` を付与して 64列）
- **行数（レコード数）**: 101,838
- **取引ID（ユニーク）**: 7,885
- **伝票番号（ユニーク）**: 4,046（ただし行の46.6%で欠損）

## 粒度（重要）
- 1行は「取引（会計）×商品明細」に近い（同一`取引ID`が複数行に出現し、`商品名/数量/販売単価`が変わる）
- BIFTEKI分析の「伝票単位（=1組）」に合わせるキーは、`伝票番号`より **`取引ID` が安定**

## 日時系の列（パースOK）
- `取引日時`（会計時刻として使えそう）
- `入店日時`（入店時刻として使えそう）
- `精算日時`（会計確定時刻として使えそう、僅かに欠損あり）
- `締め日時`（日付、営業日として使えそう）

## BIFTEKIスクリプト前提へのマッピング案（第一版）
### 伝票（H.* 相当）
- `H.伝票番号` ← `取引ID`（推奨）
- `H.伝票発行日`（入店）← `入店日時`
- `H.伝票処理日`（退店）← `精算日時`（無い場合は`取引日時`で代替）
- `H.集計対象営業年月日` ← `締め日時`（無い場合は`取引日時`の日付部）
- `H.曜日` ← `H.集計対象営業年月日`から算出
- `H.客数（合計）` ← `客数`

### 商品明細（D.* 相当）
- `D.商品` / `D.商品名` ← `商品名`
- `D.商品コード` ← `商品コード`（欠損あり）
- `D.価格` ← `販売単価`（または`販売価格計（値引済）（税込）/数量`で再計算）
- `D.商品カテゴリ1` ← POS側にEATIN/TAKEOUT区分が見当たらないため、当面は全件 `EAT IN` として扱う（要検証）
- `D.サブメニュー` は存在しないため、BIFTEKIのベース価格推定ロジックは流用しない/作り直し

## 追加情報（確定）
- **持ち帰りは無し**（全件EAT INとして扱う）

## 追加で確認したいこと（次）
- テイクアウト判定の手掛かり（部門名/商品名/取引区分等に含まれるか）
- `取引明細区分`（返品/部門売り）の扱い
- 値引き・割引の取り込み方針（`単品値引`/`単品割引`/`小計値引き` 等）

