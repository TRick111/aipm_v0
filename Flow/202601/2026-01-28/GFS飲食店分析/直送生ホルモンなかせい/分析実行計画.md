---
date: 2026-01-28
project: GFS飲食店分析
store: 直送生ホルモンなかせい
type: plan
version: 1.0
---

# 直送生ホルモンなかせい：分析実行計画（THE BIFTEKIと同等）

## 目的 / 成果物
- **目的**: POS売上データ（必要なら口コミ）から、経営改善に直結する示唆を抽出する（THE BIFTEKIと同等メニュー）
- **成果物（最低限）**:
  - 売上要因分析（EDA/相関/クラスタ/重要特徴量） + サマリーMD
  - （今回は実施しない）前年同比較（Y2Y）分析 + MD/HTML
  - 客数分析（曜日/時間帯/月別） + レポート/グラフ
  - 客単価分析（上昇要因/メニュー貢献） + レポート
  - セグメント分析（ランチ/ディナー×期間、High/Low分析） + レポート
  - 滞在時間/回転率（滞在時間、10分刻み店内人数、ピーク） + グラフ
  - （任意）統合「中間レポート」相当（MD/HTML/PDFのいずれか）

## 作業場所（WIP → 確定反映）
- **WIP（今日の作業）**: `Flow/202601/2026-01-28/GFS飲食店分析/直送生ホルモンなかせい/`
- **確定反映先（Stock）**: `Stock/RestaurantAILab/GFS飲食店分析/直送生ホルモンなかせい/`

## 事前に確認する入力（最重要）
- **現状の入力（確定）**
  - 取引データCSVは2期間（2024/12/01〜2025/11/30、2025/12/01〜2026/01/28）
  - **エンコーディングは両方ともcp932**
  - 列はBIFTEKI（H.* / D.*）とは異なるが、取引・商品明細・入店日時・客数を含む
- **キーとなる粒度**
  - 行は「取引×商品明細」粒度（`取引ID`が複数行に出現）
  - `伝票番号`は欠損が多いため、**伝票（=1組）キーは `取引ID` を優先**
- **スキーマ調査メモ**
  - `notes/取引データ_スキーマ調査.md` を参照

## 実行ステップ（BIFTEKIと同じ順序）

## 「中間レポート（統合版）」に必要な分析の選定（BIFTEKI準拠）
最終的に揃えるアウトプットは、BIFTEKIの統合版レポート
`Stock/RestaurantAILab/GFS飲食店分析/THE BIFTEKI 赤坂見附店/reports/THE_BIFTEKI_赤坂見附店_売上分析中間レポート.md`
と同等の章立て・指標・グラフ。

中間レポートで参照されている主な分析（= 必須）:
- **（なかせいでは除外）Y2Y（売上の全体推移）**: 月別推移（営業日あたり）、前年同月比較（営業日あたり）
- **客数分析**: 月別比較（営業日あたり）、時間帯寄与、時間帯/曜日ヒートマップ、平日vs土日
- **客単価分析**: 要因分解（品数×平均単価）、パーセンタイル変化、曜日/時間帯別、メニュー貢献度
- **回転率（滞在時間/店内人数）**: 入店〜精算の滞在時間、10分刻み店内人数、時間帯別来店×店内人数
- **売上要因（売上上位/下位の違い）**: 2軸分布、時間帯別の客数×客単価
- **セグメント分析**: 4セグメント比較（Before/After × Lunch/Dinner）＋ High/Low 比較

### Step 0: 入力配置（最初にやる）
- `input/` にPOSの生CSVを置く（店から受領したまま）
- 受領メモ（期間、営業時間、休日、改装/価格改定、メニュー変更、キャンペーン）を `notes/` に残す

### Step 1: データ準備（マージ → 整形 → EATIN/TAKEOUT分割）
- **狙い**: 以降の全分析が読める「正規化済みCSV」を作る
- **作業**:
  - CSVマージ（2期間を縦結合）→ `work/merged_transactions_20241201_20260128.csv`（UTF-8）
  - **BIFTEKI互換の中間データを生成**
    - 目的: 既存の分析スクリプト群を「入力CSV差し替え」中心で流用できる状態にする
    - 生成物（案）:
      - `work/transformed_pos_data_eatin.csv`（BIFTEKIの `transformed_pos_data_eatin.csv` 相当）
      - `work/visits_with_duration.csv` / `work/occupancy_10min.csv`（必要なら）
  - **EAT IN / TAKE OUT**
    - **持ち帰り無し**のため、全件 `EAT IN` として扱う（確定）
- **想定改修ポイント（要対応）**
  - **BIFTEKIのデータ準備スクリプト（H.* / D.*前提）はそのまま適用不可**
  - 代替: 「列名のマッピング + 営業日/曜日算出 + 取引IDでの伝票集約」を行う変換スクリプトを新規作成
  - スクリプト内に残る **絶対パス（Flow固定/Windows固定）** は排除して相対パスへ統一

## 実行方法（B案：shared scripts + 店舗ごとのrun_pipeline.sh）
- shared scripts: `Stock/RestaurantAILab/GFS飲食店分析/shared_scripts/`
- 店舗側（Flow/Stockの各店舗フォルダ）に `run_pipeline.sh` を置き、`--store-root` で shared scripts を呼び出す
- まずは `shared_scripts/scripts/02_duration/analyze_turnover.py` を `--store-root` 指定で呼び出せる形まで整備済み

### Step 2: 滞在時間 / 店内人数（回転率の土台）
- **狙い**: `伝票発行日〜処理日` から滞在時間と、10分刻み店内人数を作る
- **想定改修ポイント（要対応）**
  - 一部スクリプトに **絶対パス（Flow固定/Windows固定）** が残っているため、店舗フォルダ相対に統一

### Step 3: ピーク分析（店内人数×来店×売上の関係）
- **狙い**: ピーク帯の処理能力・売上との相関を可視化（平日/土日）

### Step 4: 売上要因分析（EDA/相関/クラスタ）
- **狙い**: 売上が伸びる日の特徴を定量化（重要特徴量、High/Low比較）

### Step 5: 前年比（Y2Y）分析
- **方針**: なかせいは過去データが取れないため **実施しない**

### Step 6: 客数分析
- **狙い**: 月別・曜日別・時間帯別の来店構造（BIFTEKIと同じ切り口）

### Step 7: 客単価分析（上昇要因・メニュー貢献）
- **狙い**: 単価が上がった/下がった理由を「価格・構成・新商品」で分解

### Step 8: セグメント分析（ランチ/ディナー×期間、High/Low）
- **狙い**: “どのセグメントを伸ばすべきか” を明確化
- **想定改修ポイント（要対応）**
  - `segment_analysis.py` 等に **環境依存の絶対パス** がある → 相対パス/引数化

### Step 9: 中間レポート（統合）
- **狙い**: 主要結論（売上のドライバー、優先アクション）を1本に統合
- BIFTEKIの `reports/` と同程度の形にまとめる

## スクリプト改修方針（先に決める）
- **方針A（最小変更）**: 店舗フォルダにスクリプトをコピーし、入力パス/店舗名だけ差し替え
- **方針B（推奨・再利用性高）**: `store_config.py`（店舗名、入力CSVパス、出力先、年範囲）を作り、全スクリプトが参照
- **必須**: 絶対パス（Flow固定/Windows固定）を排除して、店舗フォルダ相対に統一

## 今日のアウトプット（まずはここまで）
- 入力仕様の確認項目リストを埋める（POSの受領状況が分かる状態）
- 「方針A or B」を決める（スクリプト改修の最初の方針決定）
- まずは **Step1（データ準備）** を通せる状態にする（実行は次工程）

