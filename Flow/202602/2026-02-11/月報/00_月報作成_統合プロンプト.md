# 月報作成（メタ）統合プロンプト

> 本ファイルは **「月報プロジェクト全体の入口」** です。  
> 01〜03は **AIが参照してそのまま実行できる"手順書"** として整備し、更新履歴や設計意図は本ファイルに集約します。

**作成日**: 2026-02-11  
**更新日**: 2026-02-11

---

## 目的
- 月報作成の全フェーズ（基礎資料作成 → 週別深掘り分析 → スライド構成案作成 → 日報スライド作成）を **一気通貫で実行**する
- 成果物（特にスライド構成案）を、再現性ある手順で生成できる状態にする

---

## 必要なインプット（このメタプロンプトに渡す）

以下の情報を指定してください：

| 項目 | 説明 | 例 |
|------|------|-----|
| **運営会社** | 運営会社コード | `BBC` または `BFA` |
| **対象月** | 対象年月 | `2026-01` |
| **対象月の開始日** | 対象月の初日 | `2026-01-01` |
| **対象月の終了日** | 対象月の最終日 | `2026-01-31` |

### 運営会社コード一覧
- `BFA`: BAR FIVE Arrows
- `BBC`: 別天地　銀座（Dinii）
- `麻布しき`: 麻布しき（USENレジ）
- `キーポイント`: かめや駅前店（AirRegi）

---

## 実行テンプレート（AIに渡す）

以下をコピーして、変数部分を書き換えてAIに依頼してください：

```
月報を作成してください（メタプロンプト）。

## インプット情報
- 運営会社: {運営会社コード}
- 対象月: {対象月}
- 対象月の開始日: {開始日}
- 対象月の終了日: {終了日}

## 実行手順
以下のプロンプトを順番に実行し、最終的にスライド構成案を作成してください。

1. `./01_月報作成プロンプトテンプレート.md` に従って基礎資料を作成
2. `./02_週別深堀分析_プロンプト.md` に従って週別深掘り分析を実行
3. `./03_スライド構成案作成_プロンプト.md` に従ってスライド構成案を作成
4. `./04_日報スライド作成_プロンプト.md` に従って日報スライドを追加
5. `./05_HTMLスライド作成_プロンプト.md` に従ってHTMLスライドを生成

## 最終成果物
- `./2_output/{運営会社コード}/2_output_{month_slug}/月報スライド構成案.md`
- `./2_output/{運営会社コード}/2_output_{month_slug}/{month_slug}_{運営会社コード}_月次報告資料.html`
```

### コピペ用プロンプト

> 以下のブロックをそれぞれ別チャットに貼って実行してください。

---

#### ① BFA（BAR FIVE Arrows）

```
月報を作成してください。

## インプット情報
- 運営会社: BFA
- 対象月: 2026-01
- 対象月の開始日: 2026-01-01
- 対象月の終了日: 2026-01-31

## 実行手順
以下のプロンプトを順番に実行し、最終的にスライド構成案を作成してください。

1. `./01_月報作成プロンプトテンプレート.md` に従って基礎資料を作成
2. `./02_週別深堀分析_プロンプト.md` に従って週別深掘り分析を実行
3. `./03_スライド構成案作成_プロンプト.md` に従ってスライド構成案を作成
4. `./04_日報スライド作成_プロンプト.md` に従って日報スライドを追加

## 最終成果物
- `./2_output/BFA/2_output_202601/月報スライド構成案.md`
```

---

#### ② BBC（別天地　銀座）

```
月報を作成してください。

## インプット情報
- 運営会社: BBC
- 対象月: 2026-01
- 対象月の開始日: 2026-01-01
- 対象月の終了日: 2026-01-31

## 実行手順
以下のプロンプトを順番に実行し、最終的にスライド構成案を作成してください。

1. `./01_月報作成プロンプトテンプレート.md` に従って基礎資料を作成
2. `./02_週別深堀分析_プロンプト.md` に従って週別深掘り分析を実行
3. `./03_スライド構成案作成_プロンプト.md` に従ってスライド構成案を作成
4. `./04_日報スライド作成_プロンプト.md` に従って日報スライドを追加

## 最終成果物
- `./2_output/BBC/2_output_202601/月報スライド構成案.md`
```

---

#### ③ 麻布しき

```
月報を作成してください。

## インプット情報
- 運営会社: 麻布しき
- 対象月: 2026-01
- 対象月の開始日: 2026-01-01
- 対象月の終了日: 2026-01-31

## 実行手順
以下のプロンプトを順番に実行し、最終的にスライド構成案を作成してください。

1. `./01_月報作成プロンプトテンプレート.md` に従って基礎資料を作成
2. `./02_週別深堀分析_プロンプト.md` に従って週別深掘り分析を実行
3. `./03_スライド構成案作成_プロンプト.md` に従ってスライド構成案を作成
4. `./04_日報スライド作成_プロンプト.md` に従って日報スライドを追加

## 最終成果物
- `./2_output/麻布しき/2_output_202601/月報スライド構成案.md`
```

---

#### ④ キーポイント（かめや駅前店）

```
月報を作成してください。

## インプット情報
- 運営会社: キーポイント
- 対象月: 2026-01
- 対象月の開始日: 2026-01-01
- 対象月の終了日: 2026-01-31

## 実行手順
以下のプロンプトを順番に実行し、最終的にスライド構成案を作成してください。

1. `./01_月報作成プロンプトテンプレート.md` に従って基礎資料を作成
2. `./02_週別深堀分析_プロンプト.md` に従って週別深掘り分析を実行
3. `./03_スライド構成案作成_プロンプト.md` に従ってスライド構成案を作成
4. `./04_日報スライド作成_プロンプト.md` に従って日報スライドを追加

## 最終成果物
- `./2_output/キーポイント/2_output_202601/月報スライド構成案.md`
```

---

---

## 重要ルール（運用ガバナンス）
- 01/02/03/04は **AI実行手順のみ**（入力・手順・出力・チェック）を残す  
  - 更新履歴・背景説明・人向けの長文説明は **本ファイル（00）** に寄せる
- 変数名は 01/02/03/04で共通化する（下記の"変数"参照）
- 出力先は `2_output/{運営会社}/2_output_{month_slug}/` を標準とする  
  - `month_slug` は `2026-01` → `202601`（ハイフン除去）

## 変数（01/02/03/04で共通利用）
- `{運営会社コード}`: `BFA` / `BBC` / `麻布しき` / `キーポイント`
- `{対象月}`: `YYYY-MM`
- `{開始日}`: `YYYY-MM-DD`（対象月の初日）
- `{終了日}`: `YYYY-MM-DD`（対象月の最終日）
- `{month_slug}`: `YYYYMM`（例: `202601`）
- `{出力ディレクトリ}`: `./2_output/{運営会社コード}/2_output_{month_slug}`
- `{入力売上}`: `./1_input/{運営会社コード}/rawdata.csv`
- `{入力口コミ}`: `./1_input/{運営会社コード}/reviews.csv`
- `{入力日報}`: `./1_input/{運営会社コード}/DailyReport.csv`
- `{月報基礎資料}`: `{出力ディレクトリ}/月報作成基礎資料.md`
- `{スライド構成}`: `{出力ディレクトリ}/月報スライド構成案.md`

### AIが自動算出するもの（ユーザー入力不要）
- `{month_slug}`（例: `2026-01` → `202601`）
- `{出力ディレクトリ}`（上記ルールで組み立て）
- `{入力売上}` / `{入力口コミ}` / `{入力日報}`（上記ルールで組み立て）
- `{対象月に含まれるISO週}`: 対象月の営業日が1日でも含まれるISO週の一覧（例: `2026-W01` 〜 `2026-W05`）

---

## AIエージェントの実行フロー（概要）

```
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 0】準備                                                      │
│ - インプット情報を確認                                              │
│ - 入力データ（rawdata.csv, reviews.csv）の存在確認                  │
│ - {出力ディレクトリ} の作成                                         │
│ - 対象月に含まれるISO週の算出                                       │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 1】フェーズ1: 基礎資料作成                                   │
│ プロンプト: 01_月報作成プロンプトテンプレート.md                    │
│                                                                     │
│ 実行内容:                                                           │
│ 1. monthly_analysis_script.py を実行し、数値データを自動生成        │
│    → slide_data_part1〜3.txt + 各種CSV + JSON                      │
│ 2. スクリプト出力をもとに、AIが分析コメント・インサイトを付与       │
│ 3. 月報作成基礎資料.md を作成                                       │
│                                                                     │
│ 出力確認:                                                           │
│ - slide_data_part1〜3.txt が生成されていること                      │
│ - analysis_results.json / 各種CSV が生成されていること              │
│ - 月報作成基礎資料.md が作成されていること                          │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 2】フェーズ2: 週別深掘り分析                                 │
│ プロンプト: 02_週別深堀分析_プロンプト.md                           │
│ スクリプト: Scripts/deep_dive_weekly_analysis.py                    │
│                                                                     │
│ 実行内容:                                                           │
│ 1. deep_dive_weekly_analysis.py を --auto で実行                    │
│    → analysis_results.json の best_week/worst_week を自動参照       │
│    → slide_data_deep_dive.txt + deep_dive_results.json を生成       │
│ 2. AIがスクリプト出力に分析コメント・考察を付与                     │
│ 3. 月報作成基礎資料.md の 1.2 セクションに深掘り分析を追記          │
│                                                                     │
│ 出力確認:                                                           │
│ - slide_data_deep_dive.txt が生成されていること                     │
│ - deep_dive_results.json が生成されていること                       │
│ - 月報作成基礎資料.md に追記されていること                          │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 3】フェーズ3: スライド構成案作成                             │
│ プロンプト: 03_スライド構成案作成_プロンプト.md                     │
│                                                                     │
│ 実行内容:                                                           │
│ 1. スライドテンプレートを参照                                       │
│ 2. 月報作成基礎資料.md をもとにスライド構成案を作成                 │
│ 3. 各スライドにグラフ描画用のデータ表を記載                         │
│                                                                     │
│ 出力確認:                                                           │
│ - 30枚前後のスライド構成案が作成されていること                      │
│ - 各スライドにグラフ用データ表が含まれていること                    │
│ - 月報スライド構成案.md が保存されていること                        │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 4】フェーズ4: 日報スライド作成                               │
│ プロンプト: 04_日報スライド作成_プロンプト.md                       │
│                                                                     │
│ 実行内容:                                                           │
│ 1. DailyReport.csv から対象月のスタッフ日報を読み込み               │
│ 2. テーマを抽出し、4〜6枚のスライドを構成                          │
│ 3. 施策一覧の前に挿入し、スライド番号をリナンバー                   │
│                                                                     │
│ 出力確認:                                                           │
│ - 4〜6枚の日報スライドが追加されていること                          │
│ - 各スライドのタイトルが最大2つであること                            │
│ - 引用のみで構成され、分析コメントがないこと                        │
│ - 施策一覧の前に配置されていること                                  │
│ - 月報スライド構成案.md が更新保存されていること                    │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 5】フェーズ5: HTMLスライド生成                                │
│ プロンプト: 05_HTMLスライド作成_プロンプト.md                       │
│                                                                     │
│ 実行内容:                                                           │
│ 1. 月報スライド構成案.md を入力として読み込み                       │
│ 2. D3.jsでグラフを描画し、アノテーション・色分け・フォント強調を適用│
│ 3. 1スライド=1ページとしてHTML化（PDF改ページ対応）                 │
│                                                                     │
│ 出力確認:                                                           │
│ - HTMLファイルがブラウザで正しく表示されること                       │
│ - 全グラフにアノテーション・色分けが適用されていること               │
│ - PDF出力時に1スライド=1ページで分離されること                      │
└─────────────────────────────────────────────────────────────────────┘
                                  ↓
┌─────────────────────────────────────────────────────────────────────┐
│ 【Step 6】完了報告                                                  │
│ - 作成されたファイル一覧を報告                                      │
│ - 主要なインサイト（月次売上、好調/不調週など）をサマリー報告       │
└─────────────────────────────────────────────────────────────────────┘
```

---

---

## 参照ファイル一覧

### プロンプトファイル
| 順番 | ファイル | 用途 |
|:---:|----------|------|
| 01 | `01_月報作成プロンプトテンプレート.md` | 基礎資料作成 |
| 02 | `02_週別深堀分析_プロンプト.md` | 週別深掘り分析 |
| 03 | `03_スライド構成案作成_プロンプト.md` | スライド構成案作成 |
| 04 | `04_日報スライド作成_プロンプト.md` | 日報スライド追加 |
| 05 | `05_HTMLスライド作成_プロンプト.md` | D3.js + HTMLスライド生成 |

### スクリプト
| ファイル | 用途 | 使用フェーズ |
|----------|------|:---:|
| `./Scripts/monthly_analysis_script.py` | 月報用データ分析（月次集計・週別推移・曜日別・時間帯別・カテゴリ/商品分析） | フェーズ1 |
| `./Scripts/deep_dive_weekly_analysis.py` | 週別深掘り分析（好調週 vs 不調週の5観点比較） | フェーズ2 |

> **実行例**（macOS/Linux）:
> ```bash
> python ./Scripts/monthly_analysis_script.py \
>   -m {対象月} \
>   --sales-data {入力売上} \
>   --reviews-data {入力口コミ} \
>   -o {出力ディレクトリ}
> ```
>
> **monthly_analysis_script.py**（フェーズ1）の出力:
> - `slide_data_part1.txt` — 月次KPI・6ヶ月トレンド・前年同月比較
> - `slide_data_part2.txt` — 週別推移・好調/不調週・曜日別日平均・時間帯別
> - `slide_data_part3.txt` — カテゴリ構成比・商品TOP15・構成比増減
> - `analysis_results.json` / 各種CSV — 詳細データ
>
> **deep_dive_weekly_analysis.py**（フェーズ2）の出力:
> - `slide_data_deep_dive.txt` — 好調週 vs 不調週の比較表（曜日別・時間帯別・会計レベル・カテゴリ別）
> - `deep_dive_results.json` — 深掘り分析結果（JSON）

### 入力データ
| ファイル | 用途 |
|----------|------|
| `./1_input/{運営会社コード}/rawdata.csv` | 売上トランザクションデータ |
| `./1_input/{運営会社コード}/reviews.csv` | 口コミデータ |
| `./1_input/{運営会社コード}/DailyReport.csv` | スタッフ日報（フェーズ4で使用） |

---

---

## 最終成果物（完了条件）

以下のファイルが作成されていれば完了です：

```
Stock/RestaurantAILab/月報/2_output/{運営会社}/2_output_{month_slug}/
│
├── 【スクリプト出力（自動生成）】
│   ├── slide_data_part1.txt     ← 月次KPI・6ヶ月トレンド
│   ├── slide_data_part2.txt     ← 週別推移・曜日別・時間帯別
│   ├── slide_data_part3.txt     ← カテゴリ・商品分析
│   ├── analysis_results.json
│   ├── monthly_sales.csv
│   ├── weekly_in_month.csv
│   ├── weekday_monthly.csv
│   ├── hourly_monthly.csv
│   ├── category_monthly.csv
│   ├── product_monthly.csv
│   ├── analysis_memo.txt
│   ├── slide_data_deep_dive.txt  ← フェーズ2で追加
│   └── deep_dive_results.json    ← フェーズ2で追加
│
├── 【月報基礎資料】
│   └── 月報作成基礎資料.md
│
├── 【フェーズ3の成果物】
│   └── 月報スライド構成案.md
│
└── 【フェーズ5の成果物】
    └── {month_slug}_{運営会社コード}_月次報告資料.html  ← 最終成果物
```

---

---

## エラー時の対応（最小）

### フェーズ1でエラーが発生した場合
- rawdata.csv または reviews.csv が存在するか確認
- 対象月のデータが含まれているか確認

### フェーズ2でエラーが発生した場合
- 月次集計データが生成されているか確認
- 好調/不調週の特定に必要なデータが揃っているか確認

### フェーズ3でエラーが発生した場合
- 月報作成基礎資料.md が作成されているか確認

### フェーズ4でエラーが発生した場合
- DailyReport.csv が `./1_input/{運営会社コード}/` に存在するか確認
- 対象月の営業日に該当するレコードがあるか確認
- DailyReport.csv が存在しない場合はフェーズ4をスキップし、そのまま完了とする

---

---

## 注意事項（設計意図）

1. **データの事前準備**
   - rawdata.csv と reviews.csv が対象月の全データを含んでいることを確認
   - 月初・月末の営業日データが欠落していないことを確認

2. **月の境界の扱い**
   - 月初/月末がISO週の途中にまたがる場合、**営業日（business_date）ベース**で月に帰属させる
   - 例: 2026-01-31（土）の深夜2時の売上 → 2026-01-31の営業日 → 1月に帰属

3. **営業日基準**
   - 深夜0-5時は前日の営業日としてカウント（週報と同じルール）
   - 時間別分析は18-26時（深夜は24時以降表記）

4. **週報との関係**
   - 月報は週報の上位集計であり、週報で使用したデータを月単位で再集計する
   - 週報の分析観点を月次に拡張し、より俯瞰的なトレンド分析を行う

5. **前月比・前年同月比**
   - 月報では「前月比」「前年同月比」を主要な比較軸とする
   - 週報の「前週比」「前年同週比」に相当する

---

## プロンプト資産の更新履歴（00に集約）

- 2026-02-12: BFA 2026-01月報のフィードバックを 03/05 に反映
  - 03: 週別概況に営業日数必須化、商品ランキングTOP15→TOP10、コンテンツ量の上限ルール追加
  - 05: フォントサイズ全体1.5倍化、print-color-adjust追加、@page size追加、コールアウト配置ルール（はみ出し防止）、主張の優先度差別化（Primary/Secondary）、big-numコールアウト+テーブルパターン追加、3カラムカードパターン追加、コンテンツはみ出し防止ルール追加
- 2026-02-11: 初版作成（週報プロンプト 00〜04 をベースに月次版へ変換）
