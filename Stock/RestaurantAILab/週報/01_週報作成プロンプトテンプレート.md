# 01: 週報作成（フェーズ1）— 基礎資料作成（AI手順書）

> 目的や更新履歴は `00_週報作成_統合プロンプト.md` に集約済み。  
> 本ファイルは **AIが参照して実行できる手順** のみを記載します。

---

## 入力（00から渡される前提）
- `{運営会社コード}`（例: `BFA` / `BBC`）
- `{対象週}`（例: `2026-W04`）
- `{終了日}`（例: `2026-01-25`）
- `{week_slug}`（例: `2026w04`）
- `{出力ディレクトリ}`（例: `./2_output/BFA/2_output_2026w04`）
- `{入力売上}`（例: `./1_input/BFA/rawdata.csv`）
- `{入力口コミ}`（例: `./1_input/BFA/reviews.csv`）

---

## 参照
- 判断基準: `./分析観点.md`
- 分析スクリプト: `./Scripts/analysis_script.py`

---

## 手順（AIが実行）

### 1) 入力データの存在確認
- `{入力売上}` と `{入力口コミ}` が存在すること
- `{入力売上}` に `{対象週}` のデータが含まれること（不足していたら「rawdata更新が必要」と明示）

### 2) Python分析を実行して、アウトプットを生成
実行コマンド（例）:

```bash
python "./Scripts/analysis_script.py" \
  -w {対象週} \
  -e {終了日} \
  --sales-data "{入力売上}" \
  --reviews-data "{入力口コミ}" \
  -o "{出力ディレクトリ}"
```

※ 必要に応じて `--images` を付与（PNGも出力する）

### 3) 出力ファイルの生成確認（最低限）
以下が `{出力ディレクトリ}` に生成されていること:
- `analysis_results.json`
- `weekday_decomposition.csv`
- `weekly_sales.csv`
- `hourly_sales.csv`
- `category_latest.csv`
- `product_latest.csv`
- `slide_data_part1.txt`
- `slide_data_part2.txt`
- `slide_data_part3.txt`

（`--images` 指定時のみ）
- `weekly_sales_trend.png` 等のPNG

### 4) 週報作成基礎資料（Markdown）を作成
- `{出力ディレクトリ}/analysis_results.json`（必要に応じてCSV）を読み、`分析観点.md`に従って **週報作成基礎資料**をMarkdownで作成する
- 保存先: `{出力ディレクトリ}/週報作成基礎資料.md`

---

## 出力（フェーズ1の成果物）
- `{出力ディレクトリ}/週報作成基礎資料.md`
- （データ）`analysis_results.json` / CSV一式
- （任意）PNG一式（`--images`）

### 1. 売上分析

#### 1.1 週次推移分析
- `analysis_results.json` の `sales_analysis.weekly_trend` を参照
- 以下の指標について、前週比・前月平均比・前年比（52週前）を分析：
  - **売上**: ビジネス全体の健全性
  - **客数**: 集客力の推移
  - **客単価**: 商品戦略の効果
  - **組数**: グループサイズの傾向
- **インサイト抽出**:
  - ✅ ポジティブな傾向（成長、改善）
  - ⚠️ 懸念事項（減少、悪化）
  - 💡 推奨アクション（具体的な施策）

#### 1.2 曜日別分析（要因分解付き）**（NEW）**
- **基本データ**: `analysis_results.json` の `sales_analysis.by_day_of_week`
- **要因分解データ**: `weekday_decomposition.csv` を参照

**分析観点**:
1. **曜日別の売上差**: 対象週 vs **過去4週間の移動平均**でどの曜日が大きく変化したか
2. **要因の内訳**:
   - **客数要因寄与**: 客数の増減が売上に与えた影響
   - **客単価要因寄与**: 1人単価の増減が売上に与えた影響
3. **深掘り対象曜日の特定**:
   - 客数要因 最大プラス/マイナス曜日
   - 客単価要因 最大プラス/マイナス曜日

**比較対象の変更点**:
- 従来：前週との比較
- 新方式：**過去4週間の移動平均**との比較（対象週を含まない直前4週間の平均値）
- メリット：週ごとのブレを平滑化し、より安定したトレンドを把握できる

**インサイト抽出**:
- ✅ ポジティブ: 客数要因・客単価要因がプラスで寄与している曜日
- ⚠️ 懸念: 客数要因が大幅マイナス（-20%以上）、客単価要因がマイナス（-10%以上）、両要因ともマイナスの曜日
- 💡 推奨アクション:
  - 客数要因マイナス → 集客施策（プロモーション、SNS施策、予約促進）
  - 客単価要因マイナス → 商品ミックス改善（高単価商品訴求、追加注文促進）
  - 両要因マイナス → 総合的見直し（営業時間、スタッフ配置、メニュー構成）

**検算確認**: 各曜日で `客数要因寄与 + 客単価要因寄与 = 売上差` が成立していることを確認

#### 1.3 時間別分析（営業時間基準）
- `analysis_results.json` の `sales_analysis.by_hour` を参照
- **営業時間**: 18時〜26時（深夜は24時以降表記）
- **深夜帯**: 24-25時台（JST 0-1時）は前日営業日として集計済み

**分析観点**:
- ピーク時間帯の特定（最も売上が高い時間）
- 深夜売上（24-25時台）の比率と傾向
- 営業時間の活用状況（アイドルタイムの有無）
- 時間帯別の集客機会を提案

**インサイト抽出**:
- ✅ ピーク時間帯の強み（効率的な売上獲得）
- ⚠️ アイドルタイム（売上が低い時間帯）の存在
- 💡 推奨アクション: ハッピーアワー、深夜営業の強化、アイドルタイムの活用策

---

### 2. 商品・カテゴリ分析

#### 2.1 カテゴリ別分析と構成比推移
- **現在の構成**: `analysis_results.json` の `category_analysis.by_category`
- **構成比推移**: `category_composition_trend.csv` を参照
- 以下の観点で分析：
  - 各カテゴリの売上構成比（現在）
  - 前週比、前月比での構成比変化（ポイント）
  - 構成比の増減トレンド
- **インサイト抽出**:
  - ✅ 強み: 構成比トップ3、または前週比+2pt以上増加
  - ⚠️ 懸念: 前週比-5pt以上減少、または「その他」の比率が高い
  - 💡 推奨アクション: 人気カテゴリの強化、不振カテゴリの改善

#### 2.2 商品別分析と構成比推移（NEW）
- **現在のランキング**: `analysis_results.json` の `category_analysis.top_10_products`
- **構成比推移**: `product_composition_trend.csv` を参照
- 以下の観点で分析：
  - TOP10商品の売上額、販売数、構成比
  - 前週比、前月比での構成比変化（ポイント）
  - 商品ごとの成長・衰退トレンド
- **インサイト抽出**:
  - ✅ 強み: 売上ランキング上位、構成比が安定または成長
  - ⚠️ 懸念: 構成比急減、特定商品への依存度が高い
  - 💡 推奨アクション: 人気商品のバリエーション、死に筋の削除

---

### 3. 口コミ分析

- `analysis_results.json` の `review_analysis` を参照
- 対象週の新規投稿数とその評価点を分析
- 投稿がある場合、ポジティブ/ネガティブな傾向を考察
- 投稿がない場合、顧客エンゲージメント向上の必要性を指摘

---

### 4. 総合的な考察とアクションプラン

#### 4.1 現状総括
- **強み**: 各分析から得られた✅ポジティブ要素をまとめる
- **課題**: 各分析から得られた⚠️懸念事項をまとめる
- **優先順位**: 深刻度×影響度で課題を整理

#### 4.2 アクションプラン
- **短期施策（1-3ヶ月）**: 即効性・低コスト・既存リソースで対応可能
- **中期施策（3-6ヶ月）**: システム導入・投資が必要
- **長期施策（6ヶ月-1年）**: 戦略的な方向性転換

#### 4.3 KPI設定
- 測定可能で達成可能な目標を設定
- 現状値から10-30%の改善を基準に設定

---

---

## Markdownの最低限フォーマット（AI向け）

### ファイル保存先
- **Markdownファイル**: `{出力ディレクトリ}/週報作成基礎資料.md`

### Markdown構成と画像挿入

**重要**: 週報作成基礎資料には、必ず生成されたグラフ画像を挿入してください。
Markdown形式で `![画像の説明](./ファイル名.png)` の構文を使用して、各セクションに対応するグラフを埋め込みます。

```markdown
# {運営会社名} 週報作成基礎資料

**対象期間**: {対象期間}
**作成日**: {作成日}
**運営会社**: {運営会社コード} ({運営会社フルネーム})
**データ処理**: UTC→JST変換済み、営業日基準（深夜0-5時は前日営業日）

---

## 1. 売上分析

### 1.1 週次推移分析

#### 週次比較（前年/前月/前週/対象週）
![週次売上比較](./weekly_sales_comparison.png)

[前週比・前月比・前年比の分析]
- 売上、客数、客単価、組数の推移
- ✅ ポジティブな傾向
- ⚠️ 懸念事項
- 💡 推奨アクション

#### 週次推移トレンド（直近5週間）
![週次売上推移](./weekly_sales_trend.png)

[直近5週間のトレンド分析]
- 売上、客数、客単価、組数の時系列変化
- 対象週の位置づけ
- トレンドの方向性（上昇/横ばい/下降）

### 1.2 曜日別分析（要因分解付き）

#### 曜日別売上差分の要因分解（対象週 vs 過去4週間平均）
![曜日別要因分解](./weekday_decomposition.png)

[曜日別売上の要因分解分析]
- 各曜日の売上差（対象週 vs 過去4週間平均）
- 客数要因寄与と客単価要因寄与の分解結果
- 深掘り対象曜日の特定と分析
- ✅ ポジティブな傾向
- ⚠️ 懸念事項（客数減/単価減の曜日）
- 💡 推奨アクション（要因別の施策）

### 1.3 時間別分析（営業時間基準）

#### 時間別売上比較（対象週 vs 前週）
![時間別売上](./hourly_sales.png)

[営業時間18-26時の分析]
- ピーク時間帯の特定
- 深夜売上（24-25時台）の比率
- ✅ ピーク時間帯の強み
- ⚠️ アイドルタイムの存在
- 💡 推奨アクション

---

## 2. 商品・カテゴリ分析

### 2.1 カテゴリ別分析

#### カテゴリ別売上構成比（対象週）
![カテゴリ別売上](./category_sales.png)

[カテゴリ別売上と構成比の分析]
- 各カテゴリの構成比と前週比・前月比の変化
- ✅ 強み（人気カテゴリ）
- ⚠️ 懸念（不振カテゴリ）
- 💡 推奨アクション

### 2.2 商品別分析

#### 商品別売上構成比 TOP10 + その他（対象週）
![商品別売上TOP10](./top_products.png)

[商品別売上TOP10と構成比の分析]
- TOP10商品の構成比と前週比・前月比の変化
- ✅ 強み（売れ筋商品）
- ⚠️ 懸念（死に筋候補、特定商品への依存）
- 💡 推奨アクション

---

## 3. 口コミ分析

#### 口コミ評価の分布（対象週）
![口コミ評価分布](./review_ratings.png)

[対象週の口コミ投稿と評価分析]
- 新規投稿数と平均評価
- ポジティブ/ネガティブな傾向
- 💡 推奨アクション

---

## 4. 総合的な考察とアクションプラン

### 4.1 現状総括
- **強み**: 各分析から得られたポジティブ要素
- **課題**: 各分析から得られた懸念事項
- **優先順位**: 深刻度×影響度での整理

### 4.2 アクションプラン
- **短期施策（1-3ヶ月）**: [即効性のある施策]
- **中期施策（3-6ヶ月）**: [投資が必要な施策]
- **長期施策（6ヶ月-1年）**: [戦略的方向性]

### 4.3 KPI設定
[測定可能で達成可能な目標設定]
```

**画像挿入のポイント**:
- 各セクションの冒頭に対応するグラフ画像を配置
- 画像パスは相対パス `./ファイル名.png` で記述
- 画像の説明文（alt text）は日本語で簡潔に記述
- グラフ画像の後に、データに基づく分析テキストを記述

---

### 実行例1: BFA の Week 43

```bash
python "Stock/RestaurantAILab/週報/Scripts/analysis_script.py" -w 2025-W43 -e 2025-10-31 --sales-data "Stock/RestaurantAILab/週報/1_input/BFA/rawdata.csv" --reviews-data "Stock/RestaurantAILab/週報/1_input/BFA/reviews.csv" -o "Stock/RestaurantAILab/週報/2_output/BFA/2_output_2025w43"

# 出力先: Stock/RestaurantAILab/週報/2_output/BFA/2_output_2025w43/
```

### 実行例2: BBC の Week 42

```bash
python "Stock/RestaurantAILab/週報/Scripts/analysis_script.py" -w 2025-W42 -e 2025-10-24 --sales-data "Stock/RestaurantAILab/週報/1_input/BBC/rawdata.csv" --reviews-data "Stock/RestaurantAILab/週報/1_input/BBC/reviews.csv" -o "Stock/RestaurantAILab/週報/2_output/BBC/2_output_2025w42"

# 出力先: Stock/RestaurantAILab/週報/2_output/BBC/2_output_2025w42/
```

### パス構造の規則

- **インプット**: `Stock/RestaurantAILab/週報/1_input/{運営会社}/rawdata.csv`
- **アウトプット**: `Stock/RestaurantAILab/週報/2_output/{運営会社}/2_output_{week}/`

この規則に従うことで、運営会社ごとにデータとレポートを整理できます。

---

---

## チェックリスト（フェーズ1完了条件）
- `{出力ディレクトリ}` にデータ出力が揃っている
- `{出力ディレクトリ}/週報作成基礎資料.md` が存在する
- 営業日基準（深夜0-5時は前日）で解釈している旨がどこかに明記されている
