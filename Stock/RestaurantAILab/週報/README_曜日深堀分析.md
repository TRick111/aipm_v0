# 曜日深堀分析ツール

## 概要

週報作成後、最も好調だった日と最も不調だった日を深掘り分析し、具体的な改善アクションを導出するツールです。

## ファイル構成

```
Stock/RestaurantAILab/週報/
├── 曜日深堀分析_プロンプト.md          # 分析依頼時のプロンプトテンプレート
├── deep_dive_weekday_analysis.py      # 自動分析スクリプト
├── README_曜日深堀分析.md             # 本ドキュメント
├── 1_input/
│   └── rawdata.csv                    # 元データ
└── 2_output_2026w01/                  # 週ごとの出力フォルダ
    ├── weekday_decomposition.csv      # 曜日別要因分解
    └── 週報作成基礎資料.md            # 分析結果の出力先
```

## 使用方法

### 方法1: Claude Codeに依頼する（推奨）

週報作成後、以下のプロンプトをClaude Codeに送信します：

```
1.2をより詳しく見てほしい。最も好調だった日と最も不調だった日をピックアップして、
以下の観点で分析を行って。

深掘り対象となった曜日については、以下をさらに分析する：
1. パーティサイズ分析: 1名/2名/3-4名/5名以上の構成変化
2. 時間帯バケット分析: ピーク時間（18-19、20-21等）の人数・売上推移
3. 会計レベルの確認: 大口会計の有無、単価分布（中央値、P10、P90）
4. 商品ミックス分析: 高単価商品の販売数、カテゴリ別売上構成
5. 例外データの確認: 営業時間外会計、特殊計上の混入
```

詳細は `曜日深堀分析_プロンプト.md` を参照してください。

### 方法2: Pythonスクリプトで自動実行

#### 基本的な使い方

```bash
python Stock/RestaurantAILab/週報/deep_dive_weekday_analysis.py \
  -w 2026-W01 \
  -e 2026-01-03 \
  --best-date 2025-12-31 \
  --worst-date 2026-01-02
```

#### パラメータ説明

| パラメータ | 必須 | 説明 | 例 |
|-----------|------|------|-----|
| `-w`, `--week` | ✓ | 対象週（ISO 8601形式） | `2026-W01` |
| `-e`, `--end-date` | ✓ | 対象週の終了日 | `2026-01-03` |
| `--best-date` | * | 好調日の日付 | `2025-12-31` |
| `--worst-date` | * | 不調日の日付 | `2026-01-02` |
| `--auto` | - | 自動判定モード（未実装） | - |
| `--input-dir` | - | 入力ディレクトリ | デフォルト: `Stock/RestaurantAILab/週報/1_input` |
| `--output-dir` | - | 出力ディレクトリ | デフォルト: `Stock/RestaurantAILab/週報/2_output_{week}` |

\* `--auto` を使用しない場合は `--best-date` と `--worst-date` が必須

#### 実行例

**2026年第1週の分析:**
```bash
cd c:\Users\auk1i\aipm_v0
python Stock\RestaurantAILab\週報\deep_dive_weekday_analysis.py -w 2026-W01 -e 2026-01-03 --best-date 2025-12-31 --worst-date 2026-01-02
```

**別の週の分析:**
```bash
python Stock\RestaurantAILab\週報\deep_dive_weekday_analysis.py -w 2026-W02 -e 2026-01-10 --best-date 2026-01-07 --worst-date 2026-01-09
```

## 出力内容

### コンソール出力

1. **基本情報**: 売上、客数、会計数、平均客単価
2. **パーティサイズ分析**: 1名/2名/3-4名/5名以上の構成比と売上
3. **時間帯バケット分析**: 時間帯別の会計数・客数・売上
4. **会計レベル分析**: 最大/最小/中央値/P10/P90/平均、会計金額分布
5. **商品ミックス分析**: カテゴリ別売上構成、高単価商品TOP10
6. **例外データ確認**: 営業時間外会計、特殊パターン
7. **比較サマリー**: 好調日 vs 不調日の差分

### 週報への反映

Claude Codeに依頼した場合、以下のセクションが自動的に週報基礎資料に追加されます：

- `#### 深掘り分析: 水曜日(好調) vs 金曜日(不調)`
- サマリー比較表
- 5つの観点別詳細分析
- 総合考察（5つの主要因）
- 改善アクションプラン（優先度付き）

## 分析の5つの観点

### 1. パーティサイズ分析
グループサイズ別の売上構成を分析し、団体客の有無を確認します。

**チェックポイント:**
- 3名以上のグループ客の有無
- 大型パーティ（5名以上）の売上貢献度
- パーティサイズ別の客単価

### 2. 時間帯バケット分析
時間帯別の売上パターンを分析し、ピークタイムと空白時間帯を特定します。

**チェックポイント:**
- 21-22時台（通常ピーク）の会計数
- 深夜営業の売上貢献
- 空白時間帯の有無

### 3. 会計レベル分析
会計金額の分布を分析し、高額会計の有無を確認します。

**チェックポイント:**
- 1万円以上の会計の構成比
- 2万円以上の大口会計の有無
- 会計金額の中央値とばらつき

### 4. 商品ミックス分析
カテゴリ別・商品別の売上構成を分析します。

**チェックポイント:**
- ジャパニーズカクテル・オリジナルカクテルの売上
- 飲み放題プランの有無
- 高単価商品のリピート状況
- フード vs アルコールの比率

### 5. 例外データ確認
営業時間外の会計や特殊なパターンを確認します。

**チェックポイント:**
- 深夜0-6時の会計の有無
- 1名あたり¥10,000超の高額会計
- 10名以上の大型パーティ

## カスタマイズ

### パーティサイズの区分を変更

`deep_dive_weekday_analysis.py` の `party_size_category` 関数を編集:

```python
def party_size_category(count):
    if count == 1:
        return '1名'
    elif count == 2:
        return '2名'
    elif count <= 4:
        return '3-4名'
    else:
        return '5名以上'
```

### 高単価商品の閾値を変更

```python
high_price = day_data[day_data['price'] >= 1500].copy()  # 1500 → 任意の金額
```

### 会計金額分布の区分を変更

```python
bins = [0, 5000, 10000, 15000, 20000, 100000]  # 任意の金額帯に変更
labels = ['~5千円', '5千~1万', '1万~1.5万', '1.5万~2万', '2万円以上']
```

## トラブルシューティング

### エラー: データが見つかりません

```
⚠️ 最も好調な日 (2025-12-31) のデータが見つかりません。
```

**原因**: 指定した日付のデータがrawdata.csvに存在しない

**対処法**:
1. `weekday_decomposition.csv` で実際の営業日を確認
2. 営業日基準の日付を指定（深夜0-5時は前日の営業日）
3. rawdata.csvに該当期間のデータがあるか確認

### エラー: weekday_decomposition.csv が見つかりません

```
FileNotFoundError: Stock/RestaurantAILab/週報/2_output_2026w01/weekday_decomposition.csv が見つかりません
```

**対処法**:
先に週報の基本分析を実行してください：
```bash
python Stock/RestaurantAILab/週報/analysis_script.py -w 2026-W01 -e 2026-01-03
```

### 文字化けが発生する

**対処法**:
Windows環境で文字化けする場合、コマンドプロンプトのコードページを変更：
```bash
chcp 65001
python Stock\RestaurantAILab\週報\deep_dive_weekday_analysis.py ...
```

## 更新履歴

- **2026-01-05**: 初版リリース
  - 5つの観点での深掘り分析機能
  - 好調日 vs 不調日の比較分析
  - コマンドライン引数による柔軟な実行

## 関連ファイル

- `analysis_script.py`: 週報の基本分析スクリプト
- `generate_docx.py`: Word形式への変換スクリプト
- `weekday_decomposition.csv`: 曜日別要因分解データ

## ライセンス

内部利用のみ
