---
description: "週報HTMLスライドの監査を実施し、監査レポートと監査チェックリストを作成する"
alwaysApply: false
---

# 週報監査スキル

週報作成エージェントが生成した成果物（基礎資料・スライド構成案・HTML・中間データファイル）を監査し、品質を担保するためのスキル。

---

## 監査対象ファイル

以下のファイルを全文読み込み、クロスチェックを行う。

| ファイル | 役割 |
|---------|------|
| `weekly_sales.csv` | 売上・客数・客単価・組数の週次推移 |
| `weekday_decomposition.csv` | 曜日別の客数要因・客単価要因分解 |
| `category_latest.csv` | カテゴリ別売上・構成比 |
| `product_latest.csv` | 商品別売上・構成比 |
| `analysis_results.json` | 前月平均・前年同週など比較データ |
| `slide_data_part1.txt` | 第1部用データ |
| `slide_data_part2.txt` | 第2部用データ |
| `slide_data_part3.txt` | 第3部用データ |
| `週報作成基礎資料.md` | Phase 1の出力 |
| `週報スライド構成案.md` | Phase 3の出力 |
| `*.html` | Phase 5の最終成果物 |
| `dailyreport.csv` / `DailyReport.csv` | 日報データ（該当店舗のみ） |

---

## 監査項目（全7カテゴリ・25項目）

### A. データソース整合性（4項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| A1 | CSV/JSON → 基礎資料の転記 | weekly_sales / weekday_decomposition / category_latest / product_latest / analysis_results の主要数値が基礎資料に正確に転記されているか |
| A2 | 基礎資料 → スライド構成案の転記 | KPI・曜日別・カテゴリ別・商品別・施策の全数値が構成案に正確に転記されているか |
| A3 | スライド構成案 → HTMLの反映 | D3.jsグラフデータ・テーブル数値・msg-barの内容が構成案と一致しているか |
| A4 | slide_data_part1-3の整合性 | 3ファイルの数値が元CSV/JSONと一致しているか |

### B. 数値計算の正確性（3項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| B1 | 前週比・前月平均比の検算 | 主要KPI（売上・客数・客単価）の前週比・前月平均比・前年比を独自に計算し、報告値と照合。小数点以下の丸め差は許容 |
| B2 | 構成比合計の確認 | カテゴリ別構成比の合計が≈100%になるか確認。丸め誤差（±0.1%程度）は許容 |
| B3 | 曜日別要因分解の検算 | 客数要因+客単価要因≈売上差を検証。ミッドポイント法ではP0×A0≠S0（平均の積≠積の平均）のため構造的な残差が発生する。CSVからの転記が正確であれば**合格**とする。残差の大きさに関わらず、転記の正確性のみを判定基準とする |

### C. スライド構成・フォーマット（4項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| C1 | スライド枚数 | 日報あり店舗: 約31枚、日報なし店舗: 約28枚の基準に合致するか |
| C2 | 主張バーの有無 | タイトルスライド（slide-1）を除く全スライドに`msg-bar`クラスの1文メッセージがあるか |
| C3 | グラフスライドのデータ確認 | グラフ付きスライドで数値が確認可能か。D3.jsグラフにデータラベルが表示されていれば**合格**。別途データ表の添付は必須ではない |
| C4 | スライド番号の連番 | ページ番号（「X / N」形式）が連番で正しいか。プログレスバーも連動しているか |

### D. 分析品質（4項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| D1 | 分析観点.mdへの準拠 | 表現基準（±20%以上→「大幅に」等）、トーン（客観的・建設的・具体的・前向き）を遵守しているか |
| D2 | 好調/不調曜日の選定根拠 | 客数要因・客単価要因の最大/最小に基づく選定が、CSVの数値と一致しているか |
| D3 | 施策提案の論理性 | 各施策が分析結果・日報の内容から論理的に導出されているか |
| D4 | 課題と施策の一貫性 | 総合考察の課題とKPI設定が整合しているか |

### E. 日報反映の正確性（4項目）

**日報未導入店舗の場合**: E1-E3はN/A（対象外）とし、E4のみ検証する。

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| E1 | 日報データの引用正確性 | dailyreport.csvの対象週エントリが正確に引用されているか。原文と照合 |
| E2 | 日報スライドの枚数 | 3〜5枚の基準に合致するか |
| E3 | 日報スライドの配置順序 | 第5部（日報）→ 第6部（施策一覧）の順序が正しいか |
| E4 | 日報の引用純粋性 / 誤混入チェック | 日報スライドに分析コメント（💡マーク付きのTips等）が混入していないか。日報未導入店舗ではHTML内に日報関連コンテンツが混入していないか確認 |

### F. 除外項目の遵守（2項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| F1 | 口コミ関連の除外 | 口コミデータの**分析**が含まれていないこと。施策提案として口コミ施策（「口コミ投稿依頼」等）が記載されている場合は**問題なし**。分析と施策提案を区別する |
| F2 | 禁止ワードの除外 | 最終成果物（HTML）に禁止ワード（達成率・Win・Loss・トップ10・サイズ・ケース等）が含まれていないこと。中間生成物（slide_data、基礎資料等）での残存は**許容**する |

### G. HTML品質（4項目）

| ID | 項目名 | 検証内容 |
|----|--------|---------|
| G1 | HTML構文 | DOCTYPE/タグ開閉/テーブル構造/インラインスタイルが正常か |
| G2 | D3.jsスクリプト | チャート関数のAPI使用・データ配列・描画ロジックが正常か |
| G3 | page-break設定 | レガシー（page-break-*）とモダン（break-*）の両プロパティが設定されているか。最終スライドのauto除外が正常か |
| G4 | フォント・色の一貫性 | フォントファミリーの統一、COLORS定数による一元管理、全スライドでの一貫使用を確認 |

---

## 判定基準

### 項目レベル

| 結果 | 基準 |
|------|------|
| **合格** | 問題なし、または許容範囲内の差異のみ |
| **要確認** | 軽微な問題があるが、成果物の実用性は損なわない。修正推奨 |
| **不合格** | 数値の誤り・構造的な問題がある。修正必須 |
| **N/A** | 該当なし（日報未導入店舗のE1-E3等） |

### 総合評価

| 評価 | 基準 |
|------|------|
| **A（優良）** | 不合格0件、かつ要確認2件以下 |
| **B（良好）** | 不合格0件、かつ要確認3〜6件 |
| **C（要改善）** | 不合格1〜3件、または要確認7件以上 |
| **D（大幅改善要）** | 不合格4件以上 |

---

## 出力フォーマット

### 1. 監査レポート（`監査レポート_{店舗名}.md`）

以下の構成で作成すること。

```markdown
# 監査レポート: {店舗名} W{週番号}

**対象期間**: {対象期間}
**監査日**: {監査日}
**監査担当**: 週報監査エージェント
**総合評価**: **{A/B/C/D}（{評価名}）** — {1行サマリー}

---

## 要確認・不合格事項サマリー

> このセクションを冒頭に配置し、問題のある項目を一覧にする。
> 全項目合格の場合は「全項目合格。指摘事項なし。」と記載。

| 優先度 | 項目ID | 対象スライド | 内容 |
|--------|--------|------------|------|
| 高 | A2 | Slide 21 | 商品TOP10構成比が41.2%→43.3%に誤転記 |
| 低 | E4 | Slide 28 | 日報スライドに分析コメント1件混入 |

---

## A. データソース整合性

### A1: CSV/JSON → 基礎資料の転記 → {合格/要確認/不合格}

**検証内容**:
- {具体的な検証結果}
- {対象スライド番号を明記: 例「Slide 2のKPIカード」}

（以下、B〜Gまで同様に記載）
```

**重要ルール**:
- **要確認・不合格事項サマリーは必ずレポート冒頭（総合評価の直後）に配置する**
- **スライドに言及する場合は必ず「Slide X」の形式でスライド番号を明記する**
- 検証は具体的な数値を示して行う（「一致」だけでなく、実際の値を記載）
- 検算結果はテーブル形式で示す

### 2. 監査チェックリスト（`監査チェックリスト_{店舗名}.md`）

以下の構成で作成すること。

```markdown
# 監査チェックリスト: {店舗名} W{週番号}

**対象期間**: {対象期間}
**監査日**: {監査日}
**総合評価**: {A/B/C/D}（{評価名}）

---

## 全項目一覧

| カテゴリ | 項目ID | 項目名 | 結果 | 対象スライド | 備考 |
|----------|--------|--------|------|------------|------|
| A. データソース整合性 | A1 | CSV/JSON→基礎資料の転記 | 合格 | — | {概要} |
| A. データソース整合性 | A2 | 基礎資料→構成案の転記 | 不合格 | Slide 21 | {問題の概要} |
（全項目を列挙）

---

## 集計

| 結果 | 件数 | 項目ID |
|------|------|--------|
| 合格 | XX件 | A1, A2, ... |
| 要確認 | X件 | ... |
| 不合格 | X件 | ... |
| N/A | X件 | ... |
| **合計** | **XX件** | |
```

**重要ルール**:
- チェックリストの全項目一覧テーブルに**「対象スライド」列を含める**
- 特定のスライドに関連しない項目（構文チェック等）は「—」と記載

---

## 判定時の注意事項（過去の監査実績からの学び）

以下は過去の監査で確立された判定基準。これらに従うこと。

### 許容する事項（合格とする）

1. **B3: ミッドポイント法の構造的残差**
   - 客数要因+客単価要因 ≠ 売上差の乖離は、P0×A0≠S0（平均の積≠積の平均）という数学的性質に起因する
   - CSVからの転記が正確であれば合格とする
   - 乖離率の大小に関わらず判定に影響しない

2. **C3: データ表の非添付**
   - D3.jsグラフにデータラベルが直接表示されていれば、別途データ表の添付は不要
   - 合格とする

3. **F1: 施策提案における口コミ言及**
   - 「口コミ投稿依頼カード配置」等の施策提案は、口コミデータの**分析**ではない
   - 施策一覧に口コミ関連の施策が含まれていても合格とする

4. **F2: 中間生成物の禁止ワード**
   - slide_data_part*.txt や基礎資料.md など中間ファイルに禁止ワードが残存していても、最終成果物（HTML）で修正されていれば合格とする

### 不合格とする事項

1. **数値の誤転記**: CSVの値と異なる数値が基礎資料・構成案・HTMLに記載されている場合
2. **スライド番号の欠番・重複**: ページ番号が連番になっていない場合
3. **msg-barの欠落**: タイトル以外のスライドにmsg-barがない場合
4. **日報の捏造**: dailyreport.csvに存在しない内容が引用されている場合

---

## 実行手順

1. **監査対象ファイルの全文読み込み**: 上記「監査対象ファイル」に記載の全ファイルを読み込む
2. **A〜Gの各項目を順に検証**: 具体的な数値を挙げて検証結果を記録する
3. **要確認・不合格事項の整理**: 優先度（高/中/低）を付与し、対象スライド番号を特定する
4. **監査レポートの作成**: 上記フォーマットに従い、要確認・不合格サマリーを冒頭に配置して作成する
5. **監査チェックリストの作成**: 全項目一覧テーブルを作成する
6. **出力先**: 監査対象の週報と同じディレクトリ（`2_output/{店舗}/2_output_{対象週}/`）に保存する
