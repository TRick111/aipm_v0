# HACCP 管理（温度記録アプリ） 要件定義書

## 1. 背景・概要

### 1.1 システムの目的

-   小規模～中規模の飲食店を対象に、衛生管理（HACCP）の一環として、冷蔵庫・冷凍庫の温度を記録・管理するアプリを開発する。
-   まずは温度管理に特化し、将来的には清掃状況やその他の衛生チェック項目に拡張できる設計を目指す。

### 1.2 想定ユーザー

| ユーザー       | 役割                                                                                                         | アクセス権限                   |
| -------------- | ------------------------------------------------------------------------------------------------------------ | ------------------------------ |
| 店舗オーナー   | - 店舗グループ情報の編集<br>- 店舗の追加・編集<br>- 管理対象冷蔵庫の登録・編集<br>- 従業員の登録・情報管理 | 全店舗の情報にアクセス可能     |
| 従業員         | - 所属店舗の情報閲覧<br> - 冷蔵庫・冷凍庫の温度記録                                                          | 所属店舗のみ情報にアクセス可能 |
| システム管理者 | - システム全体の管理<br>- 店舗グループの作成・管理                                                           | システム全体にアクセス可能     |

### 1.3 業務フロー

-   従業員が日々の温度記録を行い、店舗オーナーがそれを確認・管理する。
-   温度が基準値を超えた場合や記録漏れがある場合は、アラートにより通知される。

## 2. 機能要件

### 2.1 システム構成要件

1. **データ構造**

    - システムは店舗グループ、店舗、設備（冷蔵庫・冷凍庫）の階層構造で管理できること。
    - 1 つの店舗グループに複数の店舗が所属し、1 つの店舗に複数の設備が所属する構成とすること。

2. **対応端末**

    - 店舗オーナー向けには、PC/スマートフォン両方からアクセス可能であること。
    - 従業員向けには、スマートフォンからアクセス可能であること。
    - システム管理者向けには、PC からアクセス可能であること。

3. **対応 OS/ブラウザ**

    - 以下の環境で動作すること：

    | OS      | 対応ブラウザ |
    | ------- | ------------ |
    | Windows | Chrome       |
    | Mac     | Safari       |
    | iOS     | Safari       |
    | Android | Chrome       |

    ※ Web アプリケーションのため、OS への依存度は小さく、対応ブラウザが動作する環境であれば基本的に利用可能である。検証に際しては、RestaurantAILab および ChefsRoom で用意できる端末で実施する。

4. **システム拡張性**
    - 将来的に QSC などが追加されることを想定し、HACCP は QSC アプリケーションの一部として構成すること。
    - 将来的に、HACCP 以外のアプリも展開し、アプリ群の一つとなるよう構成すること。

### 2.2 認証・権限管理

1. **ログイン機能**

    - 従業員は店舗ごとに設定された合言葉（パスワード）を使って従業員用画面へログインできること。
    - 店舗管理者は店舗グループごとに設定されたID、パスワードを使って店舗グループ管理画面へログインできること。
    - システム管理者は、メールアドレスとパスワードによる認証を行い、認証アプリによる 2 段階認証を実施できること。

2. **アクセス権限設定**
    - 従業員は自身が所属する店舗の温度記録入力が可能であること。
    - 店舗管理者は各店舗の記録監視・承認・アラート設定の操作が可能であること。
    - 店舗管理者は店舗グループの全店舗に対してアクセス権を持つ。（この管理者はこの店舗のみ見れる、などの制御は行わない）
    - システム管理者はシステム全体の管理、店舗グループの追加・編集が可能であること。

### 2.3 店舗・設備管理

1. **店舗グループ管理**

    - システム管理者は店舗グループの追加・編集・削除ができること。
    - グループ別の情報管理（グループ名、法人住所、電話番号、代表者名、メールアドレス、Invoice番号、登録日、利用開始日、終了日など）ができること。

2. **店舗管理**

    - 店舗単位で管理する情報の設定・編集（店舗名、住所、連絡先など）ができること。
    - 店舗に紐づく従業員を登録できること。

3. **設備（冷蔵庫・冷凍庫）管理**
    - 各店舗の管理対象である冷蔵庫・冷凍庫を登録・編集・削除できること。
    - 名称（「冷蔵庫 1」「冷凍庫 3」など）および基準温度帯を保持できること。

### 2.4 温度記録機能

1. **記録方法**  
   以下の方法を使用可能とすること：

    - **写真撮影**：冷蔵庫/冷凍庫の温度表示パネルを撮影しアプリにアップロードできること。
    - **手動入力**：キーボード/タッチ数値を直接入力できること。

    写真撮影後、確認画面で手動修正ができること。

2. **記録保管期間**

    - 撮影した画像は30日間保存すること。

3. **入力項目**

    - 入力者氏名をテキストで記入できること（必須入力）。
    - 記録日時（自動生成）を記録できること。
    - 温度数値を記録できること。温度は1度刻みで保存し、負の数にも対応すること。
    - 設備の状態としてDFを記録できること。
    - コメント欄（問題があった場合や補足事項をテキストで記入）を設けること。
    
4. **入力頻度**

    - 各設備は1日に複数回、温度を記録できること。

5. **複数店舗・複数設備対応**

    - 店舗・設備（冷蔵庫/冷凍庫）を選択した上で記録を入力できること。
    - 画像入力では、設備を自動選択できることが望ましい（任意）。
    - 従業員が権限がある店舗のみが表示されること。
    - 従業員が複数の冷蔵庫/冷凍庫を連続して記録できる一括入力機能を提供すること。

6. **オフライン対応**

    - オフライン状態では使用できないことを明示すること。

7. **自動記録と手動入力の優先順位**
    - 手動入力と自動入力が混在する場合、手動入力を優先して表示すること。

### 2.5 データ確認機能

1. **マネージャー・オーナー向け確認画面**
    - 自身が管理する全店舗の全設備の温度記録を確認できること。
    - 各設備の画像は過去30日分を参照可能とすること。
    - カレンダーより、過去の記録を確認できること。
    - カレンダーから特定の日付に飛び、その日の設備の温度を確認・修正できること。修正したログは監査ログで保管すること。

### 2.6 アラート・通知機能

1. **基準値外アラート**

    - 冷蔵庫/冷凍庫の温度が設定した基準を超えた（または下回った）場合にアラートを表示すること。

2. **未記録アラート**
    - 指定時刻を過ぎても記録がない場合に管理者画面にアラートを表示すること。
    - 一括の一覧画面で確認ができること。

3. **対策入力**
    - アラートに対して管理者がとるべきアクションを表示すること。表示内容はアラートごとに異なるが、全店舗で共通。

4. **LINE通知**
    - 未記録、基準値外アラートを管理者のLINEへ通知できること。

### 2.7 システム管理者機能

1. **アクセス管理**
    - システム管理者は全店舗グループの管理画面へアクセスできること。

2. **ユーザー管理**
    - システム管理者は店舗グループの作成・有効化・無効化・削除を行えること。

3. **マスター管理**
    - システム管理者は店舗グループごとに、登録できる店舗数の上限を設定できること。

4. **メンテナンス管理**
    - システム管理者は通知を全店舗グループまたは選択した店舗グループにお知らせメッセージを送信できること（複数選択可能）。

## 3. 非機能要件

### 3.1 ユーザビリティ要件

-   スマートフォン中心の UI 設計（タップ操作や写真撮影を容易に）とすること。
-   アルバイトスタッフでも操作できる簡易な画面フローを提供すること。
-   一目で記録状態がわかるダッシュボードを実装すること。
-   英語表示などの国際化対応（外国籍スタッフ向け）は不要。

### 3.2 セキュリティ要件

-   **通信方式**：HTTPS 通信を実装すること。
-   **パスワード保護**：ユーザーパスワードのハッシュ化保管を行うこと。
-   **データバックアップ**：24 時間おきにシステム全体のデータバックアップを行い、ロールバックが可能であること。
-   **アクセスログ**：以下のアクションに対して（タイムスタンプ、ユーザー、IP アドレス、ブラウザ、操作内容）保存すること：
    -   ログイン
    -   温度入力
    -   温度修正
    -   店舗情報修正
    -   パスワード変更
-   **ログ保存期間**：18 ヶ月分保存すること。
-   **データの暗号化**：データベース内の個人情報や機密情報を暗号化して保存すること。

### 3.3 データ管理要件

-   各種データはシステム管理者が削除しない限り削除は行わない。

### 3.4 パフォーマンス・スケーラビリティ要件

-   同時アクセス数が増えても安定して動作するサーバ設計とすること。
-   画像を大量にアップロードしても遅延が起きにくい設計とすること。
    -   画像ファイルはファイルストレージサービス（Vercel Blobなど）に保存する。
-   将来的に多数の店舗グループが登録される前提を考慮した設計とすること。
-   基準を超える応答遅延が生じた場合のスケールアウト戦略を用意すること。

## 4. SLA 要件

### 4.1 可用性（Uptime）

-   サービス全体の稼働率は 99.9%以上を目標とすること（月あたりの許容ダウンタイムは約 43 分以内）。
-   計画的なメンテナンス時間はこの稼働率の計算から除外する。

### 4.2 応答時間（Response Time）

-   平均応答時間は 1 秒以下を目標とすること。
-   95%のリクエストが 2 秒以内に処理完了すること。
-   画像アップロード時の応答時間は、通常の操作より長くなることを許容するが、5 秒以内を目標とすること。

### 4.3 サポート対応時間 (Chef's Room で保守)

-   重大インシデント発生時は、初期対応を 12 時間以内に開始すること。
-   通常の問い合わせには、1 営業日以内に初期応答すること。
-   サポート対応時間は平日 10:00〜18:00 とすること。

### 4.4 障害復旧時間（Incident Resolution Time）

-   重大障害：24 時間以内に復旧を目指すこと。
-   一般的な障害：48 時間以内に解決を目指すこと。
-   障害レベルの分類（クリティカル、メジャー、マイナー）と対応フローを明確にすること。

### 4.5 メンテナンスウィンドウ

-   定期メンテナンスは月 1 回、業務時間外（6:00〜11:00）に実施すること。
-   メンテナンス実施の 72 時間前までに、店舗オーナーへ通知すること。
-   緊急メンテナンスが必要な場合は、可能な限り早く通知し、影響を最小限に抑えること。

### 4.6 データバックアップと復旧

-   RPO（Recovery Point Objective）：24 時間以内（データ損失の許容幅）
-   RTO（Recovery Time Objective）：24 時間以内（システム復旧時間）
-   バックアップデータは、本番環境とは物理的に異なる場所に保存すること。

## 5. 運用・保守要件

### 5.1 障害対応要件

-   24時間おきにデータバックアップを実施すること。
-   サーバ障害時に備え冗長化した構成をとること。

### 5.2 マニュアル要件

-   従業員向けの簡易操作マニュアル（スマホ版ページ）を提供すること。
-   マネージャー・オーナー向け設定マニュアル（Web ページ）を提供すること。
-   設計書、運用手順書を作成し、納品すること。

### 5.3 運用体制

-   システムは Chef's Room 所有のクラウド環境に構築すること。
-   システム納品後の運用・保守は Chef's Room が担当すること。
-   システム管理者向けの運用マニュアルを提供し、Chef's Room のシステム管理者が運用できるようにすること。
-   初期構築時のみ、RestaurantAILab がサポートを行うこと。

### 5.4 納品物

以下の成果物を納品すること：

1. **ソフトウェア関連**

    - ソースコード一式（GitHub などのリポジトリへのアクセス権）
    - データベース定義書
    - API 仕様書
    - デプロイ手順書

2. **ドキュメント関連**

    - システム設計書
    - 画面設計書
    - テスト結果報告書
    - 運用マニュアル
    - 障害対応マニュアル
    - バックアップ・リストア手順書
    - セキュリティ対策実施報告書

3. **その他**
    - 開発環境構築手順書
    - 各種アカウント情報（開発環境、テスト環境）
    - ライセンス関連資料（使用しているオープンソースソフトウェアのライセンス情報）

## 6. テスト要件

### 6.1 UI/UX テスト要件

-   一般的な Web アプリが対応する OS、ブラウザを対象システムとすること。
-   テストは、RestaurantAILab および ChefsRoom で用意できる端末の範囲で実施すること。

### 6.2 バックエンド負荷テスト要件

-   数名が同時に操作をして問題なく動作すること。

### 6.3 セキュリティテスト要件

-   認証・権限まわりの脆弱性スキャン、SQL インジェクションや XSS などの基本的脆弱性テストを実施すること。
